"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable @typescript-eslint/no-explicit-any */
const datasource_toolkit_1 = require("@forestadmin/datasource-toolkit");
const object_hash_1 = __importDefault(require("object-hash"));
const superagent_1 = __importDefault(require("superagent"));
class ForestHttpApi {
    static async getIpWhitelistConfiguration(options) {
        try {
            const response = await superagent_1.default
                .get(new URL('/liana/v1/ip-whitelist-rules', options.forestServerUrl).toString())
                .set('forest-secret-key', options.envSecret);
            const { attributes } = response.body.data;
            return { isFeatureEnabled: attributes.use_ip_whitelist, ipRules: attributes.rules };
        }
        catch (e) {
            this.handleResponseError(e);
        }
    }
    static async getOpenIdIssuerMetadata(options) {
        try {
            const response = await superagent_1.default
                .get(new URL('/oidc/.well-known/openid-configuration', options.forestServerUrl).toString())
                .set('forest-secret-key', options.envSecret);
            return response.body;
        }
        catch (e) {
            this.handleResponseError(e);
        }
    }
    static async getUserInformation(options, renderingId, accessToken) {
        try {
            const url = new URL(`/liana/v2/renderings/${renderingId}/authorization`, options.forestServerUrl);
            const response = await superagent_1.default
                .get(url.toString())
                .set('forest-token', accessToken)
                .set('forest-secret-key', options.envSecret);
            const { attributes, id } = response.body.data;
            return {
                id: Number(id),
                email: attributes.email,
                firstName: attributes.first_name,
                lastName: attributes.last_name,
                team: attributes.teams[0],
                role: attributes.role,
                tags: attributes.tags?.reduce((memo, { key, value }) => ({ ...memo, [key]: value }), {}),
                renderingId,
                permissionLevel: attributes.permission_level,
            };
        }
        catch (e) {
            this.handleResponseError(e);
        }
    }
    static async hasSchema(options, hash) {
        try {
            const response = await superagent_1.default
                .post(new URL('/forest/apimaps/hashcheck', options.forestServerUrl).toString())
                .send({ schemaFileHash: hash })
                .set('forest-secret-key', options.envSecret);
            return !response?.body?.sendSchema;
        }
        catch (e) {
            this.handleResponseError(e);
        }
    }
    static async uploadSchema(options, apimap) {
        try {
            await superagent_1.default
                .post(new URL('/forest/apimaps', options.forestServerUrl).toString())
                .send(apimap)
                .set('forest-secret-key', options.envSecret);
        }
        catch (e) {
            this.handleResponseError(e);
        }
    }
    static async getPermissions(options, renderingId) {
        try {
            const { body } = await superagent_1.default
                .get(`${options.forestServerUrl}/liana/v3/permissions`)
                .set('forest-secret-key', options.envSecret)
                .query(`renderingId=${renderingId}`);
            if (!body.meta?.rolesACLActivated) {
                throw new Error('Roles V2 are unsupported');
            }
            const actions = new Set();
            const actionsByUser = {};
            ForestHttpApi.decodeChartPermissions(body?.stats ?? {}, actions);
            ForestHttpApi.decodeActionPermissions(body?.data?.collections ?? {}, actions, actionsByUser);
            return {
                actions,
                actionsByUser,
                scopes: ForestHttpApi.decodeScopePermissions(body?.data?.renderings?.[renderingId] ?? {}),
            };
        }
        catch (e) {
            this.handleResponseError(e);
        }
    }
    /** Helper to format permissions into something easy to validate against */
    static decodeChartPermissions(chartsByType, actions) {
        const serverCharts = Object.values(chartsByType).flat();
        const frontendCharts = serverCharts.map(chart => ({
            type: chart.type,
            filters: chart.filter,
            aggregate: chart.aggregator,
            aggregate_field: chart.aggregateFieldName,
            collection: chart.sourceCollectionId,
            time_range: chart.timeRange,
            group_by_date_field: (chart.type === 'Line' && chart.groupByFieldName) || null,
            group_by_field: (chart.type !== 'Line' && chart.groupByFieldName) || null,
            limit: chart.limit,
            label_field: chart.labelFieldName,
            relationship_field: chart.relationshipFieldName,
        }));
        const hashes = frontendCharts.map(chart => (0, object_hash_1.default)(chart, {
            respectType: false,
            excludeKeys: key => chart[key] === null || chart[key] === undefined,
        }));
        hashes.forEach(hash => actions.add(`chart:${hash}`));
    }
    /**
     * Helper to format permissions into something easy to validate against
     * Note that the format the server is sending varies depending on if we're using a remote or
     * local environment.
     */
    static decodeActionPermissions(collections, actions, actionsByUser) {
        for (const [name, settings] of Object.entries(collections)) {
            for (const [actionName, userIds] of Object.entries(settings.collection ?? {})) {
                const shortName = actionName.substring(0, actionName.length - 'Enabled'.length);
                if (typeof userIds === 'boolean')
                    actions.add(`${shortName}:${name}`);
                else
                    actionsByUser[`${shortName}:${name}`] = new Set(userIds);
            }
            for (const [actionName, actionPerms] of Object.entries(settings.actions ?? {})) {
                const userIds = actionPerms.triggerEnabled;
                if (typeof userIds === 'boolean')
                    actions.add(`custom:${actionName}:${name}`);
                else
                    actionsByUser[`custom:${actionName}:${name}`] = new Set(userIds);
            }
        }
    }
    /** Helper to format permissions into something easy to validate against */
    static decodeScopePermissions(rendering) {
        const scopes = {};
        for (const [name, { scope }] of Object.entries(rendering)) {
            scopes[name] = scope && {
                conditionTree: datasource_toolkit_1.ConditionTreeFactory.fromPlainObject(scope.filter),
                dynamicScopeValues: scope.dynamicScopesValues?.users ?? {},
            };
        }
        return scopes;
    }
    static handleResponseError(e) {
        if (/certificate/i.test(e.message))
            throw new Error('ForestAdmin server TLS certificate cannot be verified. ' +
                'Please check that your system time is set properly.');
        if (e.response) {
            const status = e?.response?.status;
            // 0 == offline, 502 == bad gateway from proxy
            if (status === 0 || status === 502)
                throw new Error('Failed to reach ForestAdmin server. Are you online?');
            if (status === 404)
                throw new Error('ForestAdmin server failed to find the project related to the envSecret you configured.' +
                    ' Can you check that you copied it properly in the Forest initialization?');
            if (status === 503)
                throw new Error('Forest is in maintenance for a few minutes. We are upgrading your experience in ' +
                    'the forest. We just need a few more minutes to get it right.');
            throw new Error('An unexpected error occured while contacting the ForestAdmin server. ' +
                'Please contact support@forestadmin.com for further investigations.');
        }
        throw e;
    }
}
exports.default = ForestHttpApi;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9yZXN0LWh0dHAtYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2FnZW50L3V0aWxzL2ZvcmVzdC1odHRwLWFwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHVEQUF1RDtBQUN2RCx3RUFBc0Y7QUFHdEYsOERBQXFDO0FBQ3JDLDREQUFpRTtBQXdDakUsTUFBcUIsYUFBYTtJQUNoQyxNQUFNLENBQUMsS0FBSyxDQUFDLDJCQUEyQixDQUN0QyxPQUFvQjtRQUVwQixJQUFJO1lBQ0YsTUFBTSxRQUFRLEdBQWEsTUFBTSxvQkFBVTtpQkFDeEMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLDhCQUE4QixFQUFFLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztpQkFDaEYsR0FBRyxDQUFDLG1CQUFtQixFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUUvQyxNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFFMUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ3JGO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0I7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxPQUFvQjtRQUN2RCxJQUFJO1lBQ0YsTUFBTSxRQUFRLEdBQWEsTUFBTSxvQkFBVTtpQkFDeEMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLHdDQUF3QyxFQUFFLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztpQkFDMUYsR0FBRyxDQUFDLG1CQUFtQixFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUUvQyxPQUFP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